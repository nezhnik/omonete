# Деплой на Reg.ru (статический хостинг)

## Вариант А: один раз собрать с полными данными и залить

Если у вас есть доступ к БД (тот же DATABASE_URL, что будет на Reg.ru):

```bash
npm run build:regru
```

Эта команда по очереди: загрузит курсы ЦБ в БД, заполнит медь с 2006 года, обновит metal-prices.json и соберёт проект. В папке **out/** будет полный **data/metal-prices.json** (включая медь за все годы). Дальше — залить содержимое **out/** на Reg.ru и настроить крон (см. ниже).

## Вариант Б: обычная сборка, бэкфилл меди на сервере

1. **Сборка:** `npm run build`
2. Залить содержимое **out/** на Reg.ru.
3. В корне сайта на сервере создать файл **.do-copper-backfill** (пустой). Один раз запустить крон вручную или выполнить:  
   `php cron-metal-prices.php`  
   Скрипт заполнит медь в БД с 2006 года и удалит файл. После этого ежедневный крон будет только обновлять последние дни.

## Что заливать на Reg.ru

Скопировать **всё содержимое** папки **`out/`** в корень сайта на хостинге.

В `out/` после сборки есть:
- HTML, JS, CSS
- **data/** — coins.json, coin-ids.json, mints.json, metal-prices.json, папка coins
- **cron-metal-prices.php** — скрипт для планировщика Reg.ru (металлы ЦБ, курс доллара, медь RusCable → БД → data/metal-prices.json)

## Крон на Reg.ru

В планировщике заданий укажите:

- **Команда:**  
  `/usr/bin/php /var/www/u2524954/data/www/omonete.ru/cron-metal-prices.php >/dev/null 2>&1`  
  (путь замените на актуальный к вашему сайту, если отличается.)

- **Расписание:** ежедневно (например утром в рабочий день).

- **Описание:** Цены металлов ЦБ, курс доллара ЦБ, медь RusCable → metal-prices.json.

На сервере в корне сайта должен быть файл **.env** с одной строкой (доступ к той же БД, что и у приложения):
```env
DATABASE_URL=mysql://логин:пароль@хост:3306/база
```
Либо настройте переменную DATABASE_URL в панели Reg.ru для окружения крона.

После запуска крона файл `data/metal-prices.json` обновляется на сервере; сайт читает его по пути `/data/metal-prices.json`. График по меди работает так же, как по остальным металлам — выводятся данные из этого файла (медь хранится в руб/г, пересчитанная из USD/т и курса ЦБ).

**Как проверить, что крон сработал:** откройте в браузере `https://ваш-домен.ru/data/cron-metal-last.json`.

## Кратко

- **Только залить out/:** выполните `npm run build:regru` (если есть БД с DATABASE_URL), затем залейте содержимое **out/** на Reg.ru и настройте крон. Либо `npm run build` → залить out/ → один раз на сервере создать .do-copper-backfill и запустить php cron-metal-prices.php → затем крон по расписанию.
- В корне сайта на сервере — **.env** с DATABASE_URL.
