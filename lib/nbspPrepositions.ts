/**
 * Неразрывные пробелы после предлогов и союзов.
 * Используется в статьях (монетные дворы и др.), чтобы при переносе строк
 * предлог/союз не оставался один в конце строки.
 * Подключите этот модуль при рендере текста или в скрипте обработки статей.
 */
export const NBSP = "\u00A0";

/** Слова, после которых ставим неразрывный пробел (предлоги, союзы, частицы) */
const WORDS_BEFORE_NBSP = [
  "из", "до", "по", "для", "при", "над", "под", "про", "без", "от",
  "во", "со", "ко", "об", "в", "с", "к", "о", "на", "за", "у",
  "и", "но", "а", "как", "да",
];

/**
 * Ставит неразрывный пробел после перечисленных слов в тексте.
 * @param text — исходный текст (абзац или строка)
 * @returns текст с подставленными \u00A0 после предлогов/союзов
 */
export function nbspAfterPrepositions(text: string): string {
  let out = text;
  for (const word of WORDS_BEFORE_NBSP) {
    const esc = word.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    const re = new RegExp(`(^|\\s)(${esc})\\s`, "gi");
    out = out.replace(re, `$1$2${NBSP}`);
  }
  return out;
}
