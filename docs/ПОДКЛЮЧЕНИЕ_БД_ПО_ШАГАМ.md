# Подключение БД по шагам — чтобы данные тянулись с Reg.ru

Выполняй **по порядку**. После всех шагов каталог и статьи будут загружаться из MySQL на Reg.ru (локально и на Vercel).

---

## Шаг 1. Локально: проверь `.env`

В корне проекта (omonete-app) должен быть файл **`.env`** с подключением к MySQL Reg.ru:

```env
DATABASE_URL="mysql://u2524954_omonete_admin:ПАРОЛЬ@server23.hosting.reg.ru:3310/u2524954_omonete"
```

Подставь свой пароль и при необходимости хост/порт из панели Reg.ru.  
Проверка: в папке проекта выполни:

```bash
node -e "require('dotenv').config({path:'.env'}); console.log(process.env.DATABASE_URL ? 'OK' : 'DATABASE_URL нет')"
```

Должно вывести `OK`.

---

## Шаг 2. Таблица статей в phpMyAdmin

1. Зайди в панель Reg.ru → раздел баз данных → **phpMyAdmin** (или открой phpMyAdmin по ссылке из письма/панели).
2. Выбери базу **u2524954_omonete** (или как у тебя называется).
3. Вкладка **SQL** → вставь содержимое файла **`scripts/mint_articles_schema.sql`** из проекта.
4. Нажми **Выполнить**.

Должно появиться сообщение об успешном создании таблицы `mint_articles`.

---

## Шаг 3. Экспорт статей в JSON и импорт в БД

Статьи сейчас в коде (`lib/mint-articles.ts`). Нужно один раз выгрузить их в JSON и залить в таблицу `mint_articles`.

**3.1.** Запусти приложение:

```bash
npm run dev
```

**3.2.** Получи файл `mint-articles.json` одним из способов:

- **Вариант А:** в другом терминале (пока `npm run dev` запущен) выполни:
  ```bash
  npm run mints:export
  ```
  Файл появится в корне проекта.

- **Вариант Б:** в браузере открой `http://localhost:3000/api/mint-articles-export`, затем **Правый клик → «Сохранить как»** и сохрани в корень проекта как **`mint-articles.json`**.

**3.3.** Останови dev-сервер (Ctrl+C). В корне проекта выполни:

```bash
npm run mints:import
```

Должно вывести что-то вроде: `✓ Импортировано статей: 12` (или другое число).

После этого таблица `mint_articles` заполнена. Файл `mint-articles.json` можно оставить в корне (он в `.gitignore` не обязан быть — при желании добавь в `.gitignore`, чтобы не коммитить).

---

## Шаг 4. Проверка локально

Снова запусти:

```bash
npm run dev
```

Проверь:

- **Главная** — блок с монетами загружается.
- **Каталог** (`/catalog/`) — список монет.
- **Любая карточка монеты** (`/coins/123/` и т.п.) — открывается.
- **Монетные дворы** → любая статья (например СПМД) — открывается.

Если всё открывается и данные есть — запросы идут в БД. Если где-то пусто или 503 — смотри консоль браузера (вкладка Network: запросы к `/api/coins`, `/api/coins/123`, `/api/mints/spmd`) и вывод в терминале `npm run dev`.

---

## Шаг 5. Vercel: переменная DATABASE_URL

1. Зайди на [vercel.com](https://vercel.com) → свой проект **omonete-app**.
2. **Settings** → **Environment Variables**.
3. Добавь переменную:
   - **Name:** `DATABASE_URL`
   - **Value:** та же строка, что в локальном `.env`:
     ```text
     mysql://u2524954_omonete_admin:ПАРОЛЬ@server23.hosting.reg.ru:3310/u2524954_omonete
     ```
   - Выбери окружения: **Production**, **Preview** (при желании).
4. Сохрани.

Удалённый доступ к MySQL у пользователя на Reg.ru уже включён (по твоему скриншоту), поэтому Vercel сможет подключаться к БД.

---

## Шаг 6. Пересборка на Vercel

После добавления `DATABASE_URL` нужно заново собрать проект:

- **Deployments** → у последнего деплоя меню (три точки) → **Redeploy**  
  или  
- Сделай любой коммит и пуш в репозиторий, к которому привязан Vercel.

Дождись окончания сборки и открой продовый сайт. Проверь главную, каталог, карточку монеты и страницу любого двора — данные должны подгружаться с БД Reg.ru.

---

## Итог

| Шаг | Что сделано |
|-----|-------------|
| 1   | В `.env` есть `DATABASE_URL` для Reg.ru |
| 2   | В phpMyAdmin создана таблица `mint_articles` |
| 3   | Статьи экспортированы в `mint-articles.json` и импортированы (`npm run mints:import`) |
| 4   | Локально сайт показывает данные с БД |
| 5   | На Vercel добавлена переменная `DATABASE_URL` |
| 6   | Выполнен redeploy |

После этого и локально, и на Vercel данные (монеты и статьи дворов) тянутся с БД на Reg.ru.
