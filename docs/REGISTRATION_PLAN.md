# Регистрация и вход: что нужно (только сайт, без доп. покупок)

## Текущее состояние

- Страница **/login** — заглушка: «Авторизация в разработке и будет позже».
- **Портфолио** — демо: загружается фиксированный список монет (RUSSIAN_FEATURED_IDS), текст: «Чтобы вести свою коллекцию, войдите в личный кабинет».
- В каталоге и на странице монеты кнопка «Добавить в коллекцию» ведёт на вход; **isAuthorized** сейчас нигде не true (реального входа нет).
- Сайт — **статический экспорт** (папка `out`), без своего API на Node в проде.

Чтобы «использовать только сайт без дополнительных покупок», нужен **минимум один из двух вариантов** ниже.

---

## Вариант 1: Свой бэкенд на вашем хостинге (без доп. сервисов)

Используете то, что уже есть или даёт хостинг (например Reg.ru): база данных + возможность выполнять серверный код (PHP или Node).

### Что нужно сделать

1. **Таблицы в БД** (та же MySQL, что для монет, или отдельная БД):
   - **users**: `id`, `email`, `password_hash`, `created_at` (при желании: имя, дата последнего входа).
   - **user_collection**: `user_id`, `coin_id` (и при необходимости количество, дата добавления) — «моя коллекция».

2. **API регистрации и входа** (на том же домене или поддомене, куда залит статику):
   - **POST /api/register** — email + пароль; проверка формата; хеш пароля (bcrypt/argon2); запись в `users`; при успехе сразу выдать сессию/токен или перенаправить на логин.
   - **POST /api/login** — email + пароль; проверка пароля; выдача сессии (cookie или JWT).
   - **POST /api/logout** — инвалидация сессии.
   - **GET /api/me** — «кто я» (если авторизован — id, email; иначе 401).
   - **GET /api/portfolio** — список coin_id в коллекции текущего пользователя.
   - **POST /api/portfolio** — добавить монету в коллекцию (body: `coin_id`).
   - **DELETE /api/portfolio?coin_id=...** — убрать монету из коллекции.

3. **Реализация API**:
   - Если хостинг даёт **PHP** — сделать эти эндпоинты на PHP (один `index.php` с роутингом или отдельные файлы), подключение к MySQL через PDO.
   - Если есть возможность запускать **Node** — небольшой Express/Fastify сервер с теми же маршрутами, та же MySQL (mysql2).

4. **Фронт (текущий Next/статический сайт)**:
   - Страница **/login**: форма «Email» + «Пароль»; кнопка «Войти»; ссылка «Регистрация» на отдельную форму или блок.
   - Страница **/register** (или блок на /login): форма «Email» + «Пароль» + повтор пароля; отправка на `POST /api/register`.
   - После успешного логина/регистрации: сохранить токен (в cookie или localStorage) и редирект в каталог или в портфолио.
   - При загрузке каталога/страницы монеты/портфолио: запрос **GET /api/me** (с токеном). Если 200 — считаем пользователя авторизованным (**isAuthorized = true**), иначе false.
   - Портфолио: загружать список монет через **GET /api/portfolio**, затем подтягивать данные монет из `/data/coins/[id].json` как сейчас.
   - Кнопка «Добавить в коллекцию» на странице монеты/в каталоге: **POST /api/portfolio** с выбранным `coin_id`; при успехе обновить локальное состояние (в коллекции / не в коллекции).

5. **Безопасность**:
   - Пароли только в виде хеша (никогда не хранить и не логировать открытый пароль).
   - Сессии: либо httpOnly cookie с серверной проверкой, либо JWT с коротким временем жизни и проверкой на API.
   - Защита от перебора: лимит попыток входа по IP/email (опционально, но желательно).

**Итог по варианту 1:** доп. покупок не нужно, если хостинг уже даёт БД и PHP/Node. Нужна только разработка: таблицы, API, формы входа/регистрации и привязка фронта к API.

---

## Вариант 2: Бесплатный BaaS (Supabase / Firebase)

Не поднимаете свой API: регистрация и вход идут через облачный сервис с бесплатным тарифом.

### Что нужно

1. **Аккаунт** (бесплатный):
   - **Supabase**: [supabase.com](https://supabase.com) — есть бесплатный tier; даёт Auth (email/пароль, при желании OAuth) + PostgreSQL.
   - Или **Firebase**: [firebase.google.com](https://firebase.google.com) — Firebase Auth (email/пароль) + при желании Firestore для коллекции.

2. **В проекте**:
   - Подключить клиент (Supabase JS или Firebase SDK).
   - Страница входа: вызов `supabase.auth.signInWithPassword` / `signUp` (или аналог в Firebase).
   - Страница регистрации: `supabase.auth.signUp({ email, password })` (подтверждение email можно включить или отключить в настройках Supabase).
   - После входа состояние «авторизован» брать из `supabase.auth.getUser()` / `onAuthStateChanged`.
   - Коллекция монет: таблица в Supabase (например `user_collection`: `user_id`, `coin_id`) или коллекция в Firestore; чтение/запись с клиента по правилам доступа (только свой user_id).

3. **Фронт**:
   - Те же формы логин/регистрация, но вместо своего API — вызовы Supabase/Firebase.
   - Портфолио и кнопка «Добавить в коллекцию» работают через Supabase/Firebase (запросы к таблице коллекции + Auth).

**Итог по варианту 2:** без своего бэкенда и без доп. оплаты (в пределах free tier). Зависимость от выбранного сервиса и его лимитов.

---

## Сводка

| Что нужно | Вариант 1 (свой бэкенд) | Вариант 2 (Supabase/Firebase) |
|-----------|--------------------------|-------------------------------|
| Хостинг с БД + PHP или Node | Да (уже есть или входит в тариф) | Не обязательно |
| Доп. покупки | Нет | Нет (free tier) |
| Таблицы users + коллекция | Свои в MySQL | В Supabase/Postgres или Firestore |
| Регистрация / логин | Свои API + формы | Supabase Auth / Firebase Auth + формы |
| Портфолио и «В коллекции» | Свой API portfolio | Supabase/Firebase API с клиента |

Для «только сайт без дополнительных покупок» достаточно либо **варианта 1** (если хостинг уже даёт БД и выполнение кода), либо **варианта 2** (если хотите обойтись без своего API и использовать бесплатный BaaS).

Дальше можно выбрать один вариант и расписать по шагам под ваш стек (например: Reg.ru + PHP или Reg.ru + Node, или Supabase).
