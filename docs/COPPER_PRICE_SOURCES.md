# Цены на медь: источники и что попробовать

ЦБ РФ публикует только драгоценные металлы (Au, Ag, Pt, Pd). Меди в их API нет. Ниже — варианты, как получить медь в рублях за грамм и подставить в график.

---

## Бесплатно и без ограничений (рекомендовано)

### Московская биржа (MOEX) — ISS API

- **Источник:** [ISS API](https://iss.moex.com/) Московской биржи. Доступ бесплатный, без регистрации и ключей. Данные в рублях.
- **Инструмент:** фьючерсы на медь (тикер **COPPER**, коды контрактов CEH6, CEM6 и т.д.). Торги с октября 2024.
- **Эндпоинты:**
  - Список контрактов: `https://iss.moex.com/iss/engines/futures/markets/forts/securities.json` (искать ASSETCODE=COPPER).
  - История по контракту: `https://iss.moex.com/iss/history/engines/futures/markets/forts/securities/{SECID}.json?from=...&till=...`
  - В ответе: `TRADEDATE`, `CLOSE`, `SETTLEPRICE` — цена в **рублях за 10 кг** (LOTVOLUME=10).
- **Формула руб/г:** `руб_за_грамм = SETTLEPRICE / 10000` (цена за 10 кг → за 1 г).
- **Ограничение:** история только с окт. 2024. Для длинной истории — LME + ЦБ или датасеты.
- **Скрипт:** `scripts/fetch-copper-price-moex.js` — запрос истории COPPER, пересчёт в руб/г, запись в БД/JSON (XCU).

### Другие бесплатные варианты

- **FRED (St. Louis Fed) PCOPPUSDA:** CSV по меди в USD. Бесплатно; для руб/г — курс ЦБ. Может быть недоступен из РФ.
- **Kaggle:** датасеты по меди (CSV). Нужна регистрация.

### Elec.ru (парсинг страницы)

- **Сайт:** [elec.ru/lme/copper](https://www.elec.ru/lme/copper/) — российский портал, текст «Цена на Лондонской бирже металлов сегодня составляет: X US$ за тонну».
- **Скрипт:** `scripts/fetch-copper-price-elec.js` — загружает страницу, парсит число из HTML, берёт курс ЦБ и считает руб/г. Бесплатно, без ключей.
- **Минусы:** парсинг хрупкий (при смене формулировки или вёрстки сломается); даёт только **текущую** цену за день. Историю можно накапливать, вызывая скрипт раз в день и записывая в БД. Для готовой истории лучше MOEX.

---

## 1. LME (Лондонская биржа) + курс ЦБ

**Идея:** цена меди на LME в USD за тонну + официальный курс ЦБ USD/RUB → пересчёт в руб/г.

- **LME (London Metal Exchange)** — основной мировой источник котировок меди. Цена обычно в **USD за тонну**.
- **Курс доллара:** бесплатно через ЦБ или зеркало:
  - JSON: `https://www.cbr-xml-daily.ru/daily_json.js` (по текущей дате)
  - По дате: `https://www.cbr-xml-daily.ru/archive/YYYY/MM/DD/daily_json.js`
  - Официально ЦБ: `http://www.cbr.ru/scripts/XML_daily.asp?date_req=DD/MM/YYYY`

**Формула:** `руб/г = (LME_USD_за_тонну / 1_000_000) * USD_RUB`.

**Откуда брать LME по дням (бесплатно с лимитами):**

| Сервис | Что даёт | Регистрация |
|--------|----------|-------------|
| **Commodities-API** (commodities-api.com) | Latest + Historical LME-XCU, JSON | Бесплатный ключ, лимит запросов |
| **Metals-API** (metals-api.com) | Latest, Historical, Time-Series по меди | Бесплатный ключ |

Оба дают цену в USD; конвертацию в рубли делаем сами по курсу ЦБ.

**Что сделать:** зарегистрироваться на одном из сервисов, получить API key, в кроне раз в день запрашивать цену меди (и при необходимости историю за период), курс ЦБ за те же даты, считать руб/г и дополнять данные для графика (например, поле XCU в `metal-prices.json` или отдельная таблица/файл).

---

## 2. Газпромбанк Open API

**Сайт:** https://www.gazprombank.ru/personal/page/openapi/

- Подключение **по заявке** (организация, ИНН, IP), ответ до 3 рабочих дней.
- В описании указаны «курсы валют и металлов»; точный список металлов (есть ли медь) нужно смотреть в инструкции (PDF на странице).
- Если банк отдаёт медь уже в рублях — не нужен отдельный источник курса; если в USD — пересчёт как выше.

**Что сделать:** оставить заявку на подключение, в инструкции проверить наличие меди и формат ответа; при наличии меди в API — использовать в кроне вместо или вместе с LME.

---

## 3. Готовые рублёвые данные (справочно)

- **ntcm.ru** — считают цену меди LME в рублях по курсу ЦБ (страница, не API; парсинг страницы возможен, но хрупкий).
- **kbn.ru** — показывают LME copper и др.; для автоматизации нужен либо API, либо парсинг.

Для стабильной автоматизации надёжнее опираться на API (п. 1 или 2).

---

## Рекомендованный порядок действий

1. **Медь из MOEX (бесплатно, без ключей):**  
   Использовать скрипт `scripts/fetch-copper-price-moex.js`: раз в день запрашивать историю фьючерса COPPER за последние дни через ISS API, пересчитывать SETTLEPRICE в руб/г и дополнять данные для графиков (поле XCU в `metal-prices.json` или столбец в БД). История на MOEX — только с окт. 2024.

2. **График:**  
   Сейчас медь на фронте — демо (apiSymbol: null). Когда в `metal-prices.json` появится XCU (массивы по периодам, как XAU/XAG), дать меди apiSymbol `"XCU"` и читать из того же JSON.

3. **LME + ЦБ (если нужна длинная история или запасной источник):**  
   Зарегистрироваться на Commodities-API или Metals-API (если сервис доступен), получить ключ, считать руб/г по формуле LME_USD_за_тонну × курс_ЦБ / 1_000_000.

4. **Газпромбанк (опционально):**  
   Подать заявку на Open API; при наличии меди в ответах — использовать как источник или запасной.

Дальше можно добавить в репозиторий черновой скрипт `scripts/fetch-copper-price.js` (или аналог на PHP для Reg.ru), который по ключу в `.env` дергает один из API и cbr-xml-daily, считает руб/г и пишет результат в файл или БД для использования в графиках.
