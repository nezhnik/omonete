# Подключение к БД (phpMyAdmin)

Чтобы приложение omonete-app могло работать с твоей базой MySQL, нужно передать строку подключения через переменную окружения.

## Контекст для ответов (не терять)

- **БД на Reg.ru.** Доступ к той же MySQL — через **phpMyAdmin** в панели Reg.ru (или по данным из раздела «Базы данных»). Это одна и та же база для сайта, крона и локальных скриптов.
- **Таблицы металлов и курса:**
  - **`cbr_rates`** — курс доллара ЦБ: `date` (DATE, PK), `usd_rub` (DECIMAL). Данные с **1992 года** (бэкфилл выполнен: `node scripts/backfill-cbr-rates.js`).
  - **`metal_prices`** — цены металлов в руб/г: `date` (DATE, UNIQUE), `xau`, `xag`, `xpt`, `xpd`, `xcu`. Металлы ЦБ с **2003 года**, медь (xcu) с **2006 года** (RusCable; бэкфилл: `node scripts/backfill-copper-ruscable.js`). Крон обновляет только последние 3 дня.
- **Итог:** в phpMyAdmin видны те же таблицы и данные; любые правки (просмотр, ручные запросы) относятся к той же БД, с которой работает крон и из которой собирается `data/metal-prices.json`. Отвечать в контексте: данные уже занесены, крон настроен, phpMyAdmin = интерфейс к этой БД.

---

## 1. Узнай данные в phpMyAdmin (или панели хостинга)

На Reg.ru (или где создана БД) в разделе «Базы данных» / phpMyAdmin нужны:

| Параметр   | Где посмотреть |
|-----------|----------------|
| **Хост**  | Обычно `server23.hosting.reg.ru` или из письма/панели хостинга |
| **Порт**  | Часто **3310** (не 3306) для удалённого MySQL на Reg.ru |
| **Имя БД** | Имя базы, которую создал (например `u2524954_omonete`) |
| **Пользователь** | Пользователь БД (например `u2524954_omonete_admin`) |
| **Пароль** | Пароль этого пользователя |

## 2. Создай файл `.env` в корне omonete-app

В папке **omonete-app** (рядом с `package.json`) создай файл **`.env`** (без .example).

Внутри одна строка:

```env
DATABASE_URL="mysql://ПОЛЬЗОВАТЕЛЬ:ПАРОЛЬ@ХОСТ:ПОРТ/ИМЯ_БАЗЫ"
```

Подставь свои значения. Пример для Reg.ru:

```env
DATABASE_URL="mysql://u2524954_omonete_admin:ТвойПароль@server23.hosting.reg.ru:3310/u2524954_omonete"
```

- Спецсимволы в пароле лучше закодировать в URL (пробел → `%20`, `@` → `%40` и т.д.) или заключить пароль в кавычки.
- Файл **`.env`** уже в `.gitignore` — в репозиторий он не попадёт.

## 3. Как это будет использоваться

Когда в проекте появится работа с БД (Prisma, API-маршруты и т.п.), код будет читать `process.env.DATABASE_URL`. Подключение настраивается так же, как в проекте **vitrabota**: там в корне лежит `.env` с одной переменной `DATABASE_URL` в формате `mysql://...`.

## Итог

1. Взять из панели/phpMyAdmin: хост, порт, имя БД, пользователь, пароль.  
2. В **omonete-app** создать `.env` с одной строкой `DATABASE_URL="mysql://..."`.  
3. Таблицы `cbr_rates` и `metal_prices` уже заполнены (курс с 1992 г., металлы и медь с 2003/2006 г.). Крон на Reg.ru настроен и обновляет только последние 3 дня. phpMyAdmin показывает ту же БД — правильные ответы в контексте проекта опираются на этот факт.

Шаблон переменных есть в **`.env.example`** — можно скопировать его в `.env` и отредактировать.
